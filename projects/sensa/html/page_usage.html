<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SensA: Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">SensA: Sensitivity Analysis for Quantitative Impact Prediction</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="page_usage">Usage </a></h1><h2><a class="anchor" id="usage_sensa">
How to use SensA</a></h2>
<h3><a class="anchor" id="sensa_requirement">
Requirement</a></h3>
<p>All the libs listed below should be in your Java classpath: <br/>
</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The versions of libs should be identical with those listed. Unpredictable behavior will occur when using different versions of libs.</dd></dl>
<p>Libraries required:</p>
<ul>
<li>JRE-1.6.0 (JDK-1.6.0.0) : for basic Java Runtime</li>
<li>jasmin-2.3.0 : required by Soot</li>
<li>polyglot-1.3.5 : required by Soot</li>
<li>java_cup.jar : required by Soot</li>
<li>soot-2.3.0 : the bytecode analysis framework underneath SensA (<b>Note</b>: SensA has not been officially tested upon Soot 2.4 or later versions)</li>
<li>DUAForensics (including three sub-packages: DUAForensics, InstrReporters and LocalsBox) : primary support for Def-Use analysis and extensive functionalities related to it, including those for profiling execution proces and forward static slicing;</li>
<li>ProbSli (including two sub-packages: ProbSli and TestAdequacy) : support for quantitative impact analysis;</li>
</ul>
<p>These libraries are required to compile SensA source package and, more other libraries may be needed to add to either the JVM class path or Soot class path, depending on which part of Sensa is to be used. Those more libraries are clarified in the sections where they are involved as follows.</p>
<h3><a class="anchor" id="sensa_input">
Input</a></h3>
<p>Simply put, the input to SensA should be the Java bytecodes, in which there is a change location of which you wish to see the impacts. The bytecodes, in the form of classfiles, are to be presented to the SensA instrumenter as the source input of the whole SensA dynamic analysis pipeline as well, which includes three phases: <br/>
(1) instrumenting subject, which instruments modification interface into the subject bytecode for later dynamic analysis; <br/>
(2) running instrumented subject, by which SensA modifies target variable in the instrumented statement in the runtime; <br/>
(3) post-processing the outputs from phase (2), through which SensA calculates change impact rankings as so to tell which points (statements) in the input subject is impacted and, especially, how much each point is impacted in terms of the rank of possibility that each is impacted compared to other impacted points.</p>
<p>As these phases being listed, the input for phase (2) is the instrumented subject classfiles, and that for the phase (3) is the outputs from running the subject instrumented. Here the running outputs are not merely the output of the original subject before instrumentation, but those in which the execution history, that SensA has instrumented by the way the modification interface was instrumented in phase (1), is mixed.</p>
<p>Another input for phase (2) is what the original subject should be fed with. In particular, SensA presumes that there is a "standard" sub-directory named "inputs" located in the "Basepath", as indicated as the second parameter of SensaRun. See the following section on "How to use SensA Run" for more details.</p>
<h3><a class="anchor" id="sensa_process">
Overall Process</a></h3>
<h2><a class="anchor" id="usage_preparesubjects">
How to prepare subjects for SensA analysis</a></h2>
<p>In order for SensA to instrument the bytecode of the target subject, adding certain statements in the subject source code is needed. In this regard however, SensA requires the addition of statements into the main/entry class of the holistic subject project only.</p>
<p>Precisely, the following statements should be added to the entry class, which is essentially an extra static method and thus would not mess the original source code up: </p>
<pre>
public class TheEntryClass {
	......
	// added for Sensa Instrumentation
	static void __link() { 
		BranchReporter.__link(); 
		DUAReporter.__link(); 
		DynSliceReporter.__link();
		ExecHistReporter.__link(); 
		Sensa.Modify.__link(); 
	}
	......
</pre><p>In order to compile this piece of code, the corresponding names should be imported as well: </p>
<pre>
	import profile.ExecHistReporter;
	import change.DynSliceReporter;
	import profile.BranchReporter;
	import profile.DUAReporter;
</pre><p> As long as the libraries required as described above are in the class paths, the compiler will be able to find the packages and names in there. For the "Sensa.Modify" to be resolved, however, the path where the SensA classfiles are located should also be added into the class path setting for compiler.</p>
<p>Now the source code of target subject with the foregoing additions can be compiled, an exemplary class path setting is given below as it is in a complete compilation script (in Linux B-shell): </p>
<div class="fragment"><pre class="fragment">
	ROOT=/home/user1/
	MAINCP=".:$ROOT/tools/DUAForensics-bins-code/DUAForensics:$ROOT/tools/DUAForensics-bins-code/InstrReporters:$ROOT/tools/Sensa/bin/:$ROOT/subject/src/"
	javac -g:source -source 1.4 -cp ${MAINCP} -d $ROOT/subject/bin subjectFile1.java
</pre></div><p> Other paths needed for the subject's class dependences and libraries ought also to be in "MAINCP". Note that the "-g:source -source:1.4" option for javac is strongly recommended for compiling subject in order to ensure correct functionalities of SensA.</p>
<p>Once the compilation succeeds, it is ready to start the instrumentation for dynamic analysis as instructed as follows. First, you need to indicate the instrumentation point for SensA to instrument modifications in the enclosing class. This instrumentation point is also referred as "change location" since you will almost always want to instrument at the change location when using SensA to predict how the change you have known about will impact other points in your whole subject project.</p>
<h2><a class="anchor" id="usage_changelocation">
How to find a specific change location</a></h2>
<p>Since the primary input of SensA is the byte-code of the target subject, change location as it is indicated to SensA is referred to based on the intermediate representation of the subject rather than its plain source code. SensA is now built and works on top of <a href="http://www.sable.mcgill.ca/soot/">the Soot framework</a> and, in particular, substantially uses Soot's <a href="http://www.sable.mcgill.ca/soot/tutorial/jimpleParser/index.html">Jimple representation</a> along with the corresponding parser to implement basic Java byte-code resolution and analysis. Therefore, the change location is specified according to where the statement in which the change is involved is located in the Jimple code derived from the original subject's source code.</p>
<h2><a class="anchor" id="usage_sensainstr">
How to use SensA Instr</a></h2>
<p>Once we have chosen the change location, instrumentation is ready to run. As shown in the following example, "change" is the statement id giving the change location and, the class path for JVM and Soot are given by "MAINCP" and "SOOTCP" respectively. To run the instrumenter using command line on Windows, the shell below script can be converted into batch script accordingly. When running it in IDEs such as Eclipse, a Run/Debug configuration can be created by picking class paths as exemplified in the script below and indicating corresponding parameters. <br/>
 The primary parameters for SensA instrumenter are explained as follows.</p>
<ul>
<li>the first parameter that SensaInst inputs is the change location, following the option "-start:"</li>
<li>the second parameter for SensaInst is the option "-exechist", meaning that ExecutionHistory instrumentation is enforced.</li>
<li>the "-d" option gives the target directory where the instrumented subject will be placed.</li>
<li>the "-main-class" gives the name of the main class, usually the same as the entry class given by the "-entry:" option.</li>
<li>the "-process-dir" receives the directory holding classes to be analyzed, including at least the entry class file of the subject. If multiple directories need be processed, you need give multiple "-process-dir" options, each indicating one of those directories.</li>
<li>all other parameters and options are to be forwarded to DUAForensics and Soot, just use exactly the same ones as shown is sufficient and recommended.</li>
</ul>
<div class="fragment"><pre class="fragment">
change=$1
ver=$2
seed=$3
ROOT=/home/hcai/
subjectloc=/home/hcai/SVNRepos/star-lab/trunk/Subjects/Schedule1/

MAINCP=".:/etc/alternatives/java_sdk/jre/lib/rt.jar:$ROOT/tools/polyglot-1.3.5/lib/polyglot.jar:$ROOT/tools/soot-2.3.0/lib/sootclasses-2.3.0.jar:$ROOT/tools/jasmin-2.3.0/lib/jasminclasses-2.3.0.jar:$ROOT/tools/DUAForensics-bins-code/DUAForensics:$ROOT/tools/DUAForensics-bins-code/LocalsBox:$ROOT/tools/DUAForensics-bins-code/InstrReporters:$ROOT/workspace/Sensa/bin:$ROOT/tools/java_cup.jar:$ROOT/workspace/ProbSli/bin" 
mkdir -p out-instr

SOOTCP=".:$ROOT/software/j2re1.4.2_18/lib/rt.jar:$ROOT/tools/DUAForensics-bins-code/DUAForensics:$ROOT/tools/DUAForensics-bins-code/LocalsBox:$ROOT/tools/DUAForensics-bins-code/InstrReporters:$ROOT/workspace/Sensa/bin:$ROOT/workspace/ProbSli/bin:$subjectloc/bin/${ver}${seed}:$subjectloc/lib"

OUTDIR=$subjectloc/instrumented-$ver-$seed-$change
mkdir -p $OUTDIR

java -Xmx1600m -ea -cp ${MAINCP} Sensa.SensaInst \
	-w -cp ${SOOTCP} \
	-p cg verbose:true,implicit-entry:false -p cg.spark verbose:true,on-fly-cg:true,rta:true \
	-f c -d "$OUTDIR" -brinstr:off -duainstr:off \
   	-duaverbose -start:$change \
	-slicectxinsens \
	-allowphantom \
	-exechist \
	-main-class ScheduleClass -entry:ScheduleClass \
	-process-dir $subjectloc/bin/${ver}${seed}  \
	1&gt;out-instr/instr-$change-${ver}${seed}.out 2&gt;out-instr/instr-$change-${ver}${seed}.err

</pre></div><h2><a class="anchor" id="usage_sensarun">
How to use SensA Run</a></h2>
<p>After successful instrumentation, the instrumented subject, the instrumented class needs to be run using SensA runner as follows.</p>
<ul>
<li>the first parameter gives the name of the entry class used in the instrumentation, namely the main class.</li>
<li>the second parameter provides the root directory of the subject, it is just used to tell the place of the SensA configuration file as mentioned above, and the place for output directories of files that keep track of modified values per test case.</li>
<li>the third parameter indicates the directory in which the entry class file lies.</li>
<li>the fourth one is the change location, the same as that used in the instrumentation.</li>
<li>the last one gives the directory where the execution history files per test case will be placed.</li>
<li>By default, the runner will run the instumented subject for specified times as indicated in the configuration file and for each, SensA tries to use a distinct value for the modification. However, it happens that the number of available distinct values can be smaller than that repetition number and then the rest of the runs can be a waste. To speed up the runs with such situations, "-DnotRunWithNotHit" can be given as "true", which is "false" by default.</li>
</ul>
<p><br/>
 An actual example of the runtime phase usage of SensA is shown below. </p>
<div class="fragment"><pre class="fragment">
change=$1
ver=$2
seed=$3

ROOT=/home/hcai/
subjectloc=/home/hcai/SVNRepos/star-lab/trunk/Subjects/Schedule1/

INDIR=$subjectloc/instrumented-$ver-$seed-$change

MAINCP=".:/etc/alternatives/java_sdk/jre/lib/rt.jar:$ROOT/tools/polyglot-1.3.5/lib/polyglot.jar:$ROOT/tools/soot-2.3.0/lib/sootclasses-2.3.0.jar:$ROOT/tools/jasmin-2.3.0/lib/jasminclasses-2.3.0.jar:$ROOT/workspace/Sensa/bin:$ROOT/workspace/ProbSli/bin:$ROOT/tools/java_cup.jar:$ROOT/tools/DUAForensics-bins-code/DUAForensics:$ROOT/tools/DUAForensics-bins-code/LocalsBox:$ROOT/tools/DUAForensics-bins-code/InstrReporters:$ROOT/workspace/Sensa/bin:$subjectloc/lib:$ROOT/workspace/TestAdequacy/bin:$INDIR"

OUTDIR=$subjectloc/outdyn-${ver}${seed}-$change
mkdir -p $OUTDIR

java -Xmx2800m -ea -cp ${MAINCP} -DnotRunWithNotHit=true Sensa.SensaRun \
	ScheduleClass \
	"$subjectloc" \
	"$INDIR" \
	$change \
	$OUTDIR

</pre></div><h2><a class="anchor" id="usage_sensaresults">
How to examine the results</a></h2>
<p><br/>
 (1) the expected outputs of SensA instrumenter are:</p>
<ul>
<li>a "stmtids.out" file, giving the Jimple code of the input subject BEFORE instrumentation, in the directory to place the instrumented subject class files as given by the "-d" option</li>
<li>the instrumented subject class files, names are kept as the same as the input classes in the directory given by the "-process-dir" option(s).</li>
</ul>
<p><br/>
 (2) the expected outputs for the run phase of SensA are:</p>
<ul>
<li>a sub-directory named "Valuestried" generated in the main subject directory given by the second parameter, where the values used for modifications are recorded per test case (not per run).</li>
<li>a sub-directory named "[inc|random|observed]-$change]" generated in the output directory given by the last parameter, where a number, same as the size of test suite, of sub-directories, each for a test case, will be generated with each holding a file of execution history for each of the number of runs as indicated in the configuration file. </li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 3 Dec 2014 for SensA by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
